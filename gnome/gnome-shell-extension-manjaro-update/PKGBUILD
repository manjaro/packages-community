# Maintainer: Chrysostomus
# Maintainer: Stefano Capitani <stefanoatmanjarodotorg>

pkgname=gnome-shell-extension-manjaro-update
_pkgname=arch-update
pkgver=1.2
_pkgver=21
pkgrel=1
pkgdesc="Convenient indicator for Manjaro updates in GNOME Shell."
arch=('any')
url="https://github.com/Chrysostomus/arch-update"
license=('GPL3')
depends=('gnome-shell>=3.18' 'update-notifier>=0.6' 'dunstify' 'pamac' 'mhwd')
makedepends=('git')
install=manjaro-update.install
source=("git://github.com/Chrysostomus/arch-update" 
        "https://github.com/RaphaelRochet/$_pkgname/archive/v$_pkgver.tar.gz" 
        'manjaro.patch')
sha512sums=('SKIP'
            '1f2f4809429d51893fe3a8ba46e168efbae9c0ab94581c08b29b4cbbe41870d0ff58c4d8939b85b400a3dbf082e64fc45a8cfa612aa78ed77a6fd0e62626b0d3'
            '5e83cccde7cf341e0ada4166b53cf2aaffc49135482876a84f587b62d21cc93fc13ab0efd3940a8f940c7190bdc753ec0e00e0a6b838444ebe242a54990a3bf3')

prepare(){
# Patch and merge the upstream repo with Chrysostomus repo
cd $srcdir
rm -f $_pkgname-$_pkgver/icons/*
mv $_pkgname/icons/* $_pkgname-$_pkgver/icons/
rm -rf $_pkgname
mv $_pkgname-$_pkgver $_pkgname
cd $srcdir/$_pkgname
patch -p1 -i ../manjaro.patch
VER=$pkgver
sed -i "s/\"version\": 20.*/\"version\": $VER/" metadata.json
}

package() {
  _uuid='manjaro-update@Chrysostomus'
  _install_dir="${pkgdir}/usr/share/gnome-shell/extensions/${_uuid}"

  install -dm655 $_install_dir
  cp -rf "$srcdir"/arch-update/* $_install_dir
}
